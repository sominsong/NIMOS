import os
import subprocess

EXPLOITDB_PATH = "./exploit/exploit-db/"
SEARCHSPLOIT_PATH = "/opt/exploitdb/"

def collect_exploit():
    # search "linux kernel", "privilege escalation" keyword in Description and "local" in Type 
    cmd = f'cat {SEARCHSPLOIT_PATH}files_exploits.csv | grep -i "Linux Kernel" | grep -i "Privilege Escalation" | grep -i ",local"'
    searchsploit_result = subprocess.check_output(cmd,shell=True).decode().strip("\n").split('\n')
    searchsploit_result = list(map(lambda x: x.split(','), searchsploit_result))

    # copy exploit codes from searchsploit to exploit-db folder
    for i, result in enumerate(searchsploit_result):
        if not os.path.exists(f"{EXPLOITDB_PATH}{result[1].split('/')[3]}"):    # if alreadly existed in exploit-db folder, pass
            os.system(f"cp {SEARCHSPLOIT_PATH}{result[1]} {EXPLOITDB_PATH}")
            print(f"[COLLECT EXPLOIT] collect {result[1].split('/')[3]} from Exploit-DB")

if __name__ == "__main__":
    collect_exploit()